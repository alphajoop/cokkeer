name: Code Quality & Build

on:
  push:
  pull_request:

jobs:
  quality:
    name: Quality, Build & Test
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      # 1Ô∏è‚É£ Checkout repository
      - name: Checkout repo
        uses: actions/checkout@v6
        with:
          persist-credentials: false

      # 2Ô∏è‚É£ Setup Bun
      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      # 3Ô∏è‚É£ Install dependencies
      - name: Install dependencies
        run: bun install

      # 4Ô∏è‚É£ Setup Biome
      - name: Setup Biome
        uses: biomejs/setup-biome@v2
        with:
          version: latest

      # 5Ô∏è‚É£ Format check
      - name: Format code
        run: bun run format

      # 6Ô∏è‚É£ Lint check
      - name: Lint code
        run: bun run lint

      # 7Ô∏è‚É£ Type check / static analysis
      - name: Check code
        run: bun run check

      # 8Ô∏è‚É£ Clean dist
      - name: Clean dist folder
        run: bun run clean

      # 9Ô∏è‚É£ Build TypeScript & bundle
      - name: Build library
        run: bun run build

      # üîü Run tests
      - name: Run tests
        run: bun test
